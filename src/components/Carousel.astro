---
import Card from './Cards.astro';
import lectanaLightImg from '../assets/lectana-light.webp';
import lectanaDarkImg from '../assets/lectana-dark.webp';
import SistemaInmobiliarioImg from '../assets/SistemaInmobiliario.png';
import gameStopImg from '../assets/gameStop.png';
import vinculoPositivoImg from '../assets/vinculoPositivo.png';

const projects = [
  { 
    title: "Lectana", 
    desc: "Plataforma educativa digital que transforma la gestión de lectura y el aprendizaje en la escuela primaria y secundaria. Aprovecha la gamificación, la automatización (audiolibros TTS) y un sistema de gestión de aulas para mejorar el progreso de los estudiantes. ", 
    tags: ["NodeJS", "Express", "Supabase", "JWT"],
    imageUrl: lectanaLightImg,
    projectUrl: "https://lectana.vercel.app/",
    githubUrl: "https://github.com/tomiiroma/lectana-backend",
    docsUrl: "https://docs.neural.com"
  },
  { 
    title: "Sistema de Gestion Inmobiliario", 
    desc: "Este proyecto es un sistema de gestión desarrollado en Java para una inmobiliaria, diseñado para gestionar propiedades, clientes, transacciones y otros aspectos relacionados con la operación de una inmobiliaria.", 
    tags: ["Java", "MySQL", "Swing"],
    imageUrl: SistemaInmobiliarioImg,
    githubUrl: "https://github.com/tomiiroma/Tp_Gestor_Inmobiliaria",
    docsUrl : "https://github.com/tomiiroma/Tp_Gestor_Inmobiliaria/blob/main/README.md"
  },
  { 
    title: "GameStop App", 
    desc: "Aplicación Móvil que permite gestionar los productos de la Tienda GameStop. Desarrollado con Java en Android Studio y contando con base de datos SQLite", 
    tags: ["Java", "SQLite", "Android"],
    imageUrl: gameStopImg,
    githubUrl: "https://github.com/agusaguerom/TP2-Android",
    // Sin docs
  },
  { 
    title: "Vinculo Positivo", 
    desc: "Vínculo Positivo conecta pacientes con psicólogos de forma simple y segura. Con gestion de turnos horarios y pacientes para los profesionales.", 
    tags: ["NodeJS", "Express", "PostgreSQL", "JWT"],
    imageUrl: vinculoPositivoImg,
    projectUrl: "https://vinculo-positivo.vercel.app/",
    // Sin GitHub (Repo privado)
  }
];
---

<div class="cyber-carousel">
  <div class="carousel-stage">
    <div class="carousel-track">
      {projects.map((p) => (
        <div class="carousel-item">
       <Card 
            title={p.title} 
            description={p.desc} 
            imageUrl={p.imageUrl} 
            tags={p.tags}
            projectUrl={p.projectUrl}
            githubUrl={p.githubUrl}
            docsUrl={p.docsUrl}
          />
        </div>
      ))}
    </div>
  </div>

  <div class="carousel-ui">
    <button id="prevBtn" class="nav-btn">/PREV_</button>
    <div class="pagination">
      <span id="currentIdx">01</span>
      <span class="separator">/</span>
      <span>{projects.length.toString().padStart(2, '0')}</span>
    </div>
    <button id="nextBtn" class="nav-btn">_NEXT/</button>
  </div>
</div>

<script>
  // Función para inicializar el carrusel
  function setupCarousel() {
    const track = document.querySelector('.carousel-track');
    const items = document.querySelectorAll('.carousel-item');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const currentText = document.getElementById('currentIdx');

    if (!items.length || !prevBtn || !nextBtn) return;

    let index = 0;

    function updateCarousel() {
      items.forEach((item, i) => {
        // Limpiamos todas las clases posibles
        item.classList.remove('active', 'prev', 'next', 'hidden-left', 'hidden-right');
        
        if (i === index) {
          item.classList.add('active');
        } else if (i === index - 1) {
          item.classList.add('prev');
        } else if (i === index + 1) {
          item.classList.add('next');
        } else if (i < index) {
          item.classList.add('hidden-left');
        } else {
          item.classList.add('hidden-right');
        }
      });

      // Actualizar número de paginación
      if (currentText) {
        currentText.innerText = (index + 1).toString().padStart(2, '0');
      }

      // Deshabilitar botones en los límites
      (prevBtn as HTMLButtonElement).disabled = index === 0;
      (nextBtn as HTMLButtonElement).disabled = index === items.length - 1;
      
      // Estilo visual de botón deshabilitado
      prevBtn.style.opacity = index === 0 ? "0.3" : "1";
      nextBtn.style.opacity = index === items.length - 1 ? "0.3" : "1";
    }

    nextBtn.addEventListener('click', () => {
      if (index < items.length - 1) {
        index++;
        updateCarousel();
      }
    });

    prevBtn.addEventListener('click', () => {
      if (index > 0) {
        index--;
        updateCarousel();
      }
    });

    // Estado inicial
    updateCarousel();
  }

  // Ejecutar en la carga inicial y cuando Astro cambie de página (si usas View Transitions)
  setupCarousel();
  document.addEventListener('astro:after-swap', setupCarousel);
</script>

<style>
  .cyber-carousel {
    width: 100%;
    max-width: 1400px;
    margin: 60px auto;
    perspective: 2000px; /* Aumentado para mejor efecto 3D */
    overflow: hidden;
    padding: 40px 0;
  }

  .carousel-stage {
    position: relative;
    height: 550px;
    display: flex;
    align-items: center;
    justify-content: center;
    transform-style: preserve-3d;
  }

  .carousel-track {
    position: relative;
    width: 350px;
    height: 100%;
    transform-style: preserve-3d;
  }

  .carousel-item {
    position: absolute;
    inset: 0;
    transition: all 0.7s cubic-bezier(0.23, 1, 0.32, 1);
    pointer-events: none;
    opacity: 0;
  }

  /* --- ESTADOS 3D CORREGIDOS --- */

  .carousel-item.active {
    opacity: 1;
    transform: translateZ(200px) translateX(0);
    z-index: 10;
    pointer-events: all;
  }

  .carousel-item.prev {
    opacity: 0.4;
    transform: translateX(-105%) translateZ(-300px) rotateY(35deg);
    z-index: 5;
    filter: blur(4px) grayscale(1);
  }

  .carousel-item.next {
    opacity: 0.4;
    transform: translateX(105%) translateZ(-300px) rotateY(-35deg);
    z-index: 5;
    filter: blur(4px) grayscale(1);
  }

  .carousel-item.hidden-left {
    transform: translateX(-150%) translateZ(-500px) rotateY(45deg);
    opacity: 0;
  }

  .carousel-item.hidden-right {
    transform: translateX(150%) translateZ(-500px) rotateY(-45deg);
    opacity: 0;
  }

  /* --- UI --- */

  .carousel-ui {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 30px;
    margin-top: 20px;
  }

  .nav-btn {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--accent);
    font-family: monospace;
    padding: 10px 20px;
    cursor: pointer;
    transition: 0.3s;
    font-weight: bold;
  }

  .nav-btn:not(:disabled):hover {
    background: var(--accent);
    color: white;
    box-shadow: 0 0 20px var(--accent);
  }

  .pagination {
    font-family: monospace;
    font-size: 1.2rem;
    color: var(--text);
    min-width: 80px;
    text-align: center;
  }

  .separator {
    color: var(--accent);
    margin: 0 5px;
  }
</style>